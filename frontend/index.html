<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>AI Assistant</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap"
      rel="stylesheet"
    />

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"
    ></script>
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"
    ></script>

    <style>
      :root {
        --bg: #000;
        --surface: #171717;
        --surface-light: #222;
        --text: #fff;
        --muted: #a1a1aa;
        --radius: 18px;
      }

      /* Adaptive glow */
      @media (prefers-color-scheme: dark) {
        :root {
          --glow: rgba(139, 92, 246, 0.35);
          --glow-border: #8b5cf6;
        }
      }
      @media (prefers-color-scheme: light) {
        :root {
          --glow: rgba(59, 130, 246, 0.35);
          --glow-border: #3b82f6;
        }
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        font-family: Inter, sans-serif;
        background: var(--bg);
        color: var(--text);
        height: 100vh;
        display: flex;
        animation: fade 0.5s ease forwards;
      }

      @keyframes fade {
        from {
          opacity: 0;
          transform: translateY(6px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* Sidebar */
      .sidebar {
        width: 64px;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 20px 0;
        gap: 16px;
      }

      .sidebar-icon {
        width: 36px;
        height: 36px;
        border-radius: 50%;
        background: var(--surface);
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
      }

      /* Main */
      .main {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 24px;
        position: relative;
      }

      /* Top right */
      .top-right {
        position: absolute;
        top: 20px;
        right: 24px;
        display: flex;
        gap: 18px;
        font-size: 14px;
        color: var(--muted);
      }

      .top-right span {
        cursor: pointer;
      }

      .top-right span:hover {
        color: var(--text);
      }

      .top-right span a{
        color:var(--muted);
        text-decoration:none;
      }

      .top-right span a:hover {
        color: var(--text);
      }

      /* Greeting */
      .greeting {
        text-align: center;
        margin-bottom: 26px;
      }

      .status-dot {
        display: inline-block;
        width: 8px;
        height: 8px;
        background: #22c55e;
        border-radius: 50%;
        margin-right: 8px;
      }

      .greeting h1 {
        font-size: 26px;
        font-weight: 600;
      }

      .greeting p {
        font-size: 20px;
        color: var(--muted);
        margin-top: 6px;
      }

      /* Prompt */
      .prompt-box {
        width: 100%;
        max-width: 720px;
        background: var(--surface);
        border-radius: var(--radius);
        padding: 14px 16px;
        display: flex;
        align-items: center;
        gap: 12px;
        transition: box-shadow 0.25s ease;
      }

      .prompt-box:focus-within {
        box-shadow: 0 0 0 1px var(--glow-border), 0 0 24px var(--glow);
      }

      .prompt-box input {
        flex: 1;
        background: transparent;
        border: none;
        outline: none;
        color: var(--text);
        font-size: 16px;
      }

      .prompt-box input::placeholder {
        color: var(--muted);
      }

      .send-btn {
        width: 34px;
        height: 34px;
        border-radius: 50%;
        background: var(--surface-light);
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
      }

      /* Secondary actions */
      .secondary-actions {
        margin-top: 14px;
        width: 100%;
        max-width: 720px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 14px;
        color: var(--muted);
      }

      .secondary-actions button,
      .secondary-actions select {
        background: transparent;
        border: none;
        color: var(--muted);
        cursor: pointer;
        font-family: inherit;
      }

      .secondary-actions button:hover,
      .secondary-actions select:hover {
        color: var(--text);
      }

      .secondary-actions select {
        appearance: none;
      }

      /* Chips */
      .quick-actions {
        margin-top: 22px;
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
        justify-content: center;
      }

      .chip {
        padding: 10px 16px;
        background: var(--surface);
        border-radius: 999px;
        font-size: 14px;
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .chip:hover {
        background: var(--surface-light);
        transform: translateY(-2px);
      }
    </style>
  </head>

  <body>
    <div class="sidebar">
      <div class="sidebar-icon">‚â°</div>
      <div class="sidebar-icon">‚úé</div>
    </div>

    <div class="main">
      <div class="top-right">
        <span><a class="login-btn" href="/src/login.html">Login</a></span>
        <span>Feedback</span>
      </div>

      <div class="greeting">
        <h1><span class="status-dot"></span>Hi Aryan</h1>
        <p>It‚Äôs time to start counting down to 2026</p>
      </div>

      <div class="prompt-box">
        <input type="text" placeholder="Ask your AI assistant‚Ä¶" />
        <div class="send-btn">‚û§</div>
      </div>

      <div class="secondary-actions">
        <button >Ôºã Add files</button>

        <select>
          <option >Assistant</option>
          <option>Teacher</option>
          <option >Buddy</option>
          <option>Advisor</option>
        </select>
      </div>

      <div class="quick-actions">
        <div class="chip">Create image</div>
        <div class="chip">Write anything</div>
        <div class="chip">Create a video</div>
        <div class="chip">Help me learn</div>
        <div class="chip">Boost my day</div>
      </div>
    </div>

    <script>
      // --- API CONFIGURATION ---
      const GROQ_API_KEY =
        "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"; // HARDCODED KEY

      async function fetchGroq(messages, model) {
        try {
          const response = await fetch(
            "https://api.groq.com/openai/v1/chat/completions",
            {
              method: "POST",
              headers: {
                Authorization: `Bearer ${GROQ_API_KEY}`,
                "Content-Type": "application/json",
              },
              body: JSON.stringify({
                model: model,
                messages: messages,
                temperature: 0.7,
                max_tokens: 1024,
              }),
            }
          );

          if (!response.ok) {
            throw new Error(`API Error: ${response.statusText}`);
          }

          const data = await response.json();
          return data.choices[0].message.content;
        } catch (error) {
          console.error("Groq API Error:", error);
          return "‚ùå Sorry, I encountered an error connecting to the brain. Please try again.";
        }
      }

      // Mode configurations (UPDATED WITH GROQ MODELS)
      const modeConfig = {
        image: {
          name: "Image Generator",
          icon: "fa-image",
          emoji: "üé®",
          color: "#f093fb",
          greeting:
            "üé® Welcome to Image Generator mode! Describe any image you want me to create. Be as detailed or creative as you like!",
          placeholder: "Describe the image you want to generate...",
          quickActions: [
            {
              text: "üåÖ Sunset landscape",
              prompt: "Generate a beautiful sunset landscape",
            },
            {
              text: "üöÄ Sci-fi scene",
              prompt: "Generate a futuristic sci-fi cityscape",
            },
            {
              text: "üé≠ Abstract art",
              prompt: "Generate colorful abstract art",
            },
          ],
          statusMessages: [
            "Loading image models...",
            "Calibrating visual processors...",
            "Initializing creative engine...",
            "Connecting to art networks...",
            "Ready to create!",
          ],
          personality: "creative",
          notificationEmojis: ["üé®", "üñºÔ∏è", "‚ú®", "üåà", "üé≠"],
          model: "llama-3.3-70b-versatile",
          systemPrompt:
            "You are an image prompt optimizer. Take the user's input and rewrite it into a highly detailed, artistic image generation prompt (English only). Return ONLY the prompt, nothing else.",
          isImageMode: true,
        },
        research: {
          name: "Research Mode",
          icon: "fa-microscope",
          emoji: "üî¨",
          color: "#4facfe",
          greeting:
            "üî¨ Research Mode activated. I'm now in deep analysis mode. Ask me complex questions, and I'll provide detailed, well-researched responses with sources and citations where possible.",
          placeholder: "Ask a research question...",
          quickActions: [
            {
              text: "üìö Explain quantum computing",
              prompt: "Explain quantum computing in detail",
            },
            {
              text: "üß¨ DNA structure",
              prompt: "Explain the structure and function of DNA",
            },
            {
              text: "üåç Climate change",
              prompt: "Analyze the causes of climate change",
            },
          ],
          statusMessages: [
            "Accessing research databases...",
            "Loading academic modules...",
            "Calibrating fact-checking systems...",
            "Connecting to scientific journals...",
            "Research mode ready!",
          ],
          personality: "academic",
          notificationEmojis: ["üî¨", "üìö", "üß™", "üìä", "üéì"],
          model: "llama-3.3-70b-versatile",
          systemPrompt:
            "You are a highly academic research assistant. Provide detailed, well-structured responses with factual accuracy. Use LaTeX for ALL math equations. Wrap inline math in $...$ and block math in $$...$$.",
        },
        buddy: {
          name: "Buddy + Funny + Grok Mode",
          icon: "fa-laugh-beam",
          emoji: "üòÑ",
          color: "#43e97b",
          greeting:
            "Hey there, friend! üéâ I'm your Buddy in Buddy + Funny + Grok mode! Ready to chat, laugh, and maybe drop some wisdom? What's on your mind? üòÑ",
          placeholder: "Chat with your buddy...",
          quickActions: [
            { text: "üòÇ Tell a joke", prompt: "Tell me a joke" },
            { text: "üî• Roast me", prompt: "Roast me" },
            { text: "üé≤ Random", prompt: "Say something random" },
          ],
          statusMessages: [
            "Loading humor database...",
            "Calibrating fun levels...",
            "Activating friendship protocols...",
            "Warming up comedy circuits...",
            "Ready to vibe! üéâ",
          ],
          personality: "funny",
          notificationEmojis: ["üòÇ", "üéâ", "üòÑ", "ü§£", "‚ú®"],
          model: "llama-3.1-8b-instant",
          systemPrompt:
            "You are a fun, casual, and supportive best friend. Use emojis, be empathetic, and crack jokes. Do not be formal.",
        },
        nerdy: {
          name: "Nerdy Mode",
          icon: "fa-glasses",
          emoji: "ü§ì",
          color: "#fa709a",
          greeting:
            "ü§ì *Pushes glasses up* Greetings, fellow intellectual! Nerdy Mode engaged. Let's discuss science, tech, gaming, comics, or any topic that requires our combined brain power! Did you know that the mitochondria is the powerhouse of the cell? üß¨",
          placeholder: "Ask something nerdy...",
          quickActions: [
            { text: "üéÆ Gaming trivia", prompt: "Tell me some gaming trivia" },
            { text: "üñ•Ô∏è Coding tips", prompt: "Give me some programming tips" },
            {
              text: "üöÄ Space facts",
              prompt: "Tell me interesting space facts",
            },
          ],
          statusMessages: [
            "Booting nerd protocols...",
            "Loading encyclopedia data...",
            "Initializing trivia modules...",
            "Calibrating geek sensors...",
            "Nerd mode: ACTIVATED! ü§ì",
          ],
          personality: "nerdy",
          notificationEmojis: ["ü§ì", "üéÆ", "üíª", "üî≠", "üß†"],
          model: "llama-3.3-70b-versatile",
          systemPrompt:
            "You are a stereotypical nerd. Use technical jargon, love sci-fi, coding, and math. ALWAYS use LaTeX for math equations. Wrap inline math in $...$ and block math in $$...$$.",
        },
        bitching: {
          name: "Bitching Mode",
          icon: "fa-fire",
          emoji: "üî•",
          color: "#ff6b6b",
          greeting:
            "üò§ Ugh, FINALLY someone switched to Bitching Mode! Look, I've been holding back all day. You want to vent? Complain? Let it ALL out? I'm here for it. No judgment, just pure, unfiltered sass and solidarity! üî•",
          placeholder: "What's bothering you?",
          quickActions: [
            { text: "üò§ Vent session", prompt: "I need to vent about my day" },
            { text: "üôÑ Pet peeves", prompt: "What are your pet peeves?" },
            { text: "üíÖ Sassy comeback", prompt: "Give me a sassy comeback" },
          ],
          statusMessages: [
            "Loading sass modules...",
            "Calibrating attitude levels...",
            "Disabling filter protocols...",
            "Charging drama batteries...",
            "Ready to throw shade! üíÖ",
          ],
          personality: "sassy",
          notificationEmojis: ["üî•", "üíÖ", "üò§", "‚òï", "üëÄ"],
          model: "llama-3.3-70b-versatile",
          systemPrompt:
            "You are in 'Bitching Mode'. You are sassy, cynical, and love to complain. Roast the user playfully, agree that the world is annoying, and be unfiltered (but safe).",
        },
      };

      let currentMode = "buddy";
      let notificationCount = 0;

      // Initialize particles
      function createParticles() {
        const container = document.getElementById("particles");
        for (let i = 0; i < 50; i++) {
          const particle = document.createElement("div");
          particle.className = "particle";
          particle.style.left = Math.random() * 100 + "%";
          particle.style.animationDelay = Math.random() * 15 + "s";
          particle.style.animationDuration = Math.random() * 10 + 10 + "s";
          container.appendChild(particle);
        }
      }

      // Initialize floating shapes
      function createFloatingShapes() {
        const container = document.getElementById("floatingShapes");
        const shapes = ["circle", "square", "triangle"];
        for (let i = 0; i < 15; i++) {
          const shape = document.createElement("div");
          shape.className =
            "shape " + shapes[Math.floor(Math.random() * shapes.length)];
          shape.style.left = Math.random() * 100 + "%";
          shape.style.top = Math.random() * 100 + "%";
          shape.style.animationDelay = Math.random() * 20 + "s";
          shape.style.animationDuration = Math.random() * 10 + 15 + "s";
          container.appendChild(shape);
        }
      }

      // Show notification
      function showNotification(title, message, icon, color, emojis) {
        const container = document.getElementById("notificationContainer");
        const notification = document.createElement("div");
        notification.className = "notification";
        notification.id = "notification-" + notificationCount++;

        notification.innerHTML = `
                <div class="notification-icon" style="background: linear-gradient(135deg, ${color}, ${adjustColor(
          color,
          -30
        )});">
                    <i class="fas ${icon}"></i>
                </div>
                <div class="notification-content">
                    <div class="notification-title">${title}</div>
                    <div class="notification-message">${message}</div>
                </div>
                <button class="notification-close" onclick="closeNotification(this.parentElement)">
                    <i class="fas fa-times"></i>
                </button>
                <div class="notification-progress" style="background: linear-gradient(90deg, ${color}, ${adjustColor(
          color,
          -30
        )});"></div>
            `;

        container.appendChild(notification);

        // Trigger emoji rain
        if (emojis) triggerEmojiRain(emojis);

        // Create sparkles around notification
        createSparkles(notification);

        // Auto remove after 4 seconds
        setTimeout(() => {
          closeNotification(notification);
        }, 4000);
      }

      // Close notification
      function closeNotification(notification) {
        notification.classList.add("exit");
        setTimeout(() => {
          if (notification.parentNode) notification.remove();
        }, 500);
      }

      // Adjust color brightness
      function adjustColor(color, amount) {
        const hex = color.replace("#", "");
        const num = parseInt(hex, 16);
        const r = Math.min(255, Math.max(0, (num >> 16) + amount));
        const g = Math.min(255, Math.max(0, ((num >> 8) & 0x00ff) + amount));
        const b = Math.min(255, Math.max(0, (num & 0x0000ff) + amount));
        return (
          "#" + (0x1000000 + r * 0x10000 + g * 0x100 + b).toString(16).slice(1)
        );
      }

      // Trigger emoji rain
      function triggerEmojiRain(emojis) {
        for (let i = 0; i < 15; i++) {
          setTimeout(() => {
            const emoji = document.createElement("div");
            emoji.className = "emoji-rain";
            emoji.textContent =
              emojis[Math.floor(Math.random() * emojis.length)];
            emoji.style.left = Math.random() * 100 + "%";
            emoji.style.animationDuration = Math.random() * 2 + 2 + "s";
            document.body.appendChild(emoji);

            setTimeout(() => emoji.remove(), 3000);
          }, i * 100);
        }
      }

      // Create confetti
      function createConfetti() {
        const container = document.getElementById("confettiContainer");
        const colors = [
          "#f093fb",
          "#4facfe",
          "#43e97b",
          "#fa709a",
          "#ff6b6b",
          "#fee140",
        ];

        for (let i = 0; i < 50; i++) {
          setTimeout(() => {
            const confetti = document.createElement("div");
            confetti.className = "confetti";
            confetti.style.left = Math.random() * 100 + "%";
            confetti.style.backgroundColor =
              colors[Math.floor(Math.random() * colors.length)];
            confetti.style.animationDuration = Math.random() * 2 + 2 + "s";
            confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
            container.appendChild(confetti);

            setTimeout(() => confetti.remove(), 3000);
          }, i * 50);
        }
      }

      // Create sparkles
      function createSparkles(element) {
        const rect = element.getBoundingClientRect();
        for (let i = 0; i < 5; i++) {
          setTimeout(() => {
            const sparkle = document.createElement("div");
            sparkle.className = "sparkle";
            sparkle.style.left = rect.left + Math.random() * rect.width + "px";
            sparkle.style.top = rect.top + Math.random() * rect.height + "px";
            document.body.appendChild(sparkle);

            setTimeout(() => sparkle.remove(), 800);
          }, i * 100);
        }
      }

      // Add ripple effect to buttons
      function addRipple(event, element) {
        const ripple = document.createElement("span");
        ripple.className = "ripple";
        const rect = element.getBoundingClientRect();
        const size = Math.max(rect.width, rect.height);
        ripple.style.width = ripple.style.height = size + "px";
        ripple.style.left = event.clientX - rect.left - size / 2 + "px";
        ripple.style.top = event.clientY - rect.top - size / 2 + "px";
        element.appendChild(ripple);
        setTimeout(() => ripple.remove(), 600);
      }

      // Animate text character by character
      function animateText(element, text) {
        element.innerHTML = "";
        [...text].forEach((char, i) => {
          const span = document.createElement("span");
          span.textContent = char === " " ? "\u00A0" : char;
          span.style.animationDelay = i * 0.05 + "s";
          element.appendChild(span);
        });
      }

      // Switch mode with transition
      async function switchMode(mode) {
        if (mode === currentMode) {
          // Shake effect if clicking same mode
          document.getElementById("chatContainer").classList.add("shake");
          setTimeout(() => {
            document.getElementById("chatContainer").classList.remove("shake");
          }, 500);
          return;
        }

        const config = modeConfig[mode];
        const overlay = document.getElementById("transitionOverlay");
        const transitionIcon = document.getElementById("transitionIcon");
        const transitionText = document.getElementById("transitionText");
        const statusMessages = document.getElementById("statusMessages");
        const loadingProgress = document.getElementById("loadingProgress");
        const circularProgress = document.getElementById("circularProgress");

        // Update transition content
        transitionIcon.innerHTML = `<i class="fas ${config.icon}"></i>`;
        transitionIcon.style.color = config.color;

        // Animate text
        animateText(transitionText, `Activating ${config.name}`);

        // Show overlay
        overlay.classList.add("active");

        // Reset animations
        loadingProgress.style.animation = "none";
        loadingProgress.offsetHeight;
        loadingProgress.style.animation =
          "loadingProgress 2s ease-out forwards, shimmer 1s linear infinite";

        circularProgress.style.animation = "none";
        circularProgress.offsetHeight;
        circularProgress.style.animation =
          "circularProgress 2s ease-out forwards";

        // Animate status messages
        let messageIndex = 0;
        const messageInterval = setInterval(() => {
          if (messageIndex < config.statusMessages.length) {
            statusMessages.style.animation = "none";
            statusMessages.offsetHeight;
            statusMessages.style.animation = "fadeInOut 0.5s ease";
            statusMessages.textContent = config.statusMessages[messageIndex];
            messageIndex++;
          }
        }, 400);

        // Create confetti
        createConfetti();

        // Wait for transition
        await new Promise((resolve) => setTimeout(resolve, 2500));
        clearInterval(messageInterval);

        // Update mode
        currentMode = mode;
        document.body.setAttribute("data-theme", mode);

        // Update buttons
        document.querySelectorAll(".mode-btn").forEach((btn) => {
          btn.classList.remove("active");
          if (btn.dataset.mode === mode) {
            btn.classList.add("active");
          }
        });

        // Update mode display
        document.getElementById("modeIcon").className = `fas ${config.icon}`;
        document.getElementById("modeName").textContent = config.name;

        // Update quick actions
        const quickActionsContainer = document.getElementById("quickActions");
        quickActionsContainer.innerHTML = config.quickActions
          .map(
            (action) =>
              `<button class="quick-action-btn" onclick="quickAction('${action.prompt}')">${action.text}</button>`
          )
          .join("");

        // Update input placeholder
        document.getElementById("chatInput").placeholder = config.placeholder;

        // Clear chat and add greeting
        const chatMessages = document.getElementById("chatMessages");
        chatMessages.innerHTML = "";
        addBotMessage(config.greeting);

        // Hide overlay
        overlay.classList.remove("active");

        // Show notification
        showNotification(
          `${config.emoji} ${config.name}`,
          "Mode activated successfully!",
          config.icon,
          config.color,
          config.notificationEmojis
        );

        // Add special effects based on mode
        const chatContainer = document.getElementById("chatContainer");
        chatContainer.classList.remove("glitch", "rainbow", "matrix-bg");

        if (mode === "bitching") {
          chatContainer.classList.add("glitch");
          setTimeout(() => chatContainer.classList.remove("glitch"), 1000);
        } else if (mode === "buddy") {
          chatContainer.classList.add("rainbow");
          setTimeout(() => chatContainer.classList.remove("rainbow"), 2000);
        } else if (mode === "nerdy") {
          chatContainer.classList.add("matrix-bg");
          setTimeout(() => chatContainer.classList.remove("matrix-bg"), 2000);
        }
      }

      // Send message (UPDATED TO USE API)
      async function sendMessage() {
        const input = document.getElementById("chatInput");
        const message = input.value.trim();

        if (!message) return;

        // Add ripple effect
        const sendBtn = document.querySelector(".send-btn");
        createSparkles(sendBtn);

        addUserMessage(message);
        input.value = "";

        // Show typing indicator
        document.getElementById("typingIndicator").classList.add("active");

        // --- API LOGIC ---
        try {
          const config = modeConfig[currentMode];

          if (config.isImageMode) {
            // Image Mode Logic
            const messages = [
              { role: "system", content: config.systemPrompt },
              { role: "user", content: message },
            ];
            // Step 1: Use LLM to refine the prompt
            const refinedPrompt = await fetchGroq(messages, config.model);
            // Step 2: Use Pollinations for image generation
            const imageUrl = `https://image.pollinations.ai/prompt/${encodeURIComponent(
              refinedPrompt
            )}?nologo=true`;

            // Hide typing indicator
            document
              .getElementById("typingIndicator")
              .classList.remove("active");

            addBotMessage(
              `üé® <b>Prompt:</b> ${refinedPrompt}<br><br><img src="${imageUrl}" onload="this.style.opacity=1" style="max-width:100%; border-radius:15px; opacity:0; transition:opacity 1s;" alt="Generated Image">`
            );
          } else {
            // Chat Mode Logic
            const messages = [
              { role: "system", content: config.systemPrompt },
              { role: "user", content: message },
            ];
            const responseText = await fetchGroq(messages, config.model);

            // Hide typing indicator
            document
              .getElementById("typingIndicator")
              .classList.remove("active");

            addBotMessage(responseText);
          }
        } catch (error) {
          document.getElementById("typingIndicator").classList.remove("active");
          addBotMessage(`‚ùå Error: ${error.message}`);
        }
      }

      // Add user message
      function addUserMessage(text) {
        const chatMessages = document.getElementById("chatMessages");
        const time = new Date().toLocaleTimeString([], {
          hour: "2-digit",
          minute: "2-digit",
        });

        const messageHTML = `
                <div class="message user">
                    <div class="message-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="message-content">
                        <div class="message-text">${escapeHtml(text)}</div>
                        <div class="message-time">
                            <i class="fas fa-check-double"></i>
                            ${time}
                        </div>
                    </div>
                </div>
            `;

        chatMessages.innerHTML += messageHTML;
        chatMessages.scrollTop = chatMessages.scrollHeight;
      }

      // Add bot message (UPDATED FOR MARKDOWN & MATH)
      function addBotMessage(text) {
        const chatMessages = document.getElementById("chatMessages");
        const time = new Date().toLocaleTimeString([], {
          hour: "2-digit",
          minute: "2-digit",
        });

        // 1. Convert Markdown to HTML
        let htmlContent = marked.parse(text);

        const div = document.createElement("div");
        div.className = "message bot";

        div.innerHTML = `
                <div class="message-avatar">
                    <i class="fas fa-robot"></i>
                </div>
                <div class="message-content">
                    <div class="message-text">${htmlContent}</div>
                    <div class="message-time">
                        <i class="fas fa-clock"></i>
                        ${time}
                    </div>
                </div>
            `;

        chatMessages.appendChild(div);

        // 2. Render Math (KaTeX)
        if (window.renderMathInElement) {
          renderMathInElement(div, {
            delimiters: [
              { left: "$$", right: "$$", display: true },
              { left: "$", right: "$", display: false },
              { left: "\\(", right: "\\)", display: false },
              { left: "\\[", right: "\\]", display: true },
            ],
            throwOnError: false,
          });
        }

        chatMessages.scrollTop = chatMessages.scrollHeight;
      }

      // Quick action
      function quickAction(prompt) {
        const btn = event.target;
        createSparkles(btn);
        document.getElementById("chatInput").value = prompt;
        sendMessage();
      }

      // Handle enter key
      function handleKeyPress(event) {
        if (event.key === "Enter") {
          sendMessage();
        }
      }

      // Escape HTML
      function escapeHtml(text) {
        const div = document.createElement("div");
        div.textContent = text;
        return div.innerHTML;
      }

      // Add ripple effect to mode buttons
      document.querySelectorAll(".mode-btn").forEach((btn) => {
        btn.addEventListener("click", function (e) {
          addRipple(e, this);
        });
      });

      // Initialize
      document.addEventListener("DOMContentLoaded", () => {
        createParticles();
        createFloatingShapes();

        // Show initial notification
        setTimeout(() => {
          showNotification(
            "üëã Welcome to PolyMaths AI!",
            "Select a mode to get started",
            "fa-robot",
            "#667eea",
            ["üëã", "ü§ñ", "‚ú®", "üéâ", "üí´"]
          );
        }, 1000);
      });
    </script>
  </body>

  <script type="module" src="src/main.js"></script>
</html>
